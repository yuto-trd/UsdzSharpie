# UsdzSharpie.Viewer - OpenGL USDZ Viewer

OpenTKを使用したインタラクティブなUSDZ/USDCファイルの3Dビューワーです。

## 機能

- USDZファイルからメッシュを読み込んで表示
- Phongシェーディングによるリアルタイムレンダリング
- インタラクティブなカメラコントロール
- 自動法線計算
- 複数メッシュのサポート

## ビルド

```bash
dotnet build
```

## 実行方法

### 方法1: dotnet runを使用

```bash
dotnet run -- <USDZファイルのパス>

# 例:
dotnet run -- ../Examples/chair_swan.usdz
```

### 方法2: 実行スクリプトを使用（推奨）

プロジェクトのルートディレクトリから:

```bash
./run_viewer.sh chair_swan.usdz
```

または絶対パスを指定:

```bash
./run_viewer.sh /path/to/your/model.usdz
```

## コントロール

| 操作 | 説明 |
|------|------|
| **左クリック + ドラッグ** | カメラを回転 |
| **マウスホイール** | ズームイン/アウト |
| **ESC** | アプリケーションを終了 |

## システム要件

- .NET 10.0 以上
- OpenGL 3.3 Core Profile以上をサポートするグラフィックカード
- macOS / Linux / Windows

## トラブルシューティング

### ウィンドウが表示されない
- グラフィックドライバーが最新か確認してください
- OpenGL 3.3以上がサポートされているか確認してください

### モデルが表示されない
- コンソール出力でメッシュが読み込まれているか確認してください
- ログに "Created X mesh renderers" と表示されているか確認してください
- カメラをズームアウトしてみてください（マウスホイール）

### ファイルが読み込めない
- USDZファイルのパスが正しいか確認してください
- ファイルが破損していないか確認してください

## 技術詳細

### レンダリングパイプライン

1. **読み込み**: UsdzReaderがUSDZファイルをパースし、UsdcSceneを生成
2. **初期化**: 各メッシュに対してMeshRendererを作成し、VBO/EBO/VAOを設定
3. **レンダリング**: 各フレームでシェーダーを適用し、全メッシュを描画

### シェーダー

- **頂点シェーダー**: モデル・ビュー・プロジェクション変換を適用
- **フラグメントシェーダー**: Phongシェーディングモデル
  - アンビエントライティング (30%)
  - ディフューズライティング
  - スペキュラーハイライト (光沢度: 32)

### データフロー

```
USDZ File
    ↓
UsdzReader.Read()
    ↓
UsdcScene (シーングラフ)
    ↓
MeshRenderer[] (各メッシュ)
    ↓
OpenGL (VBO/EBO/VAO)
    ↓
Shader (レンダリング)
```

## 開発

### 新しい機能の追加

- **テクスチャサポート**: UsdcMaterial.DiffuseTextureからテクスチャを読み込み
- **アニメーション**: TimeSamplesデータを使用
- **マテリアル拡張**: PBRパラメータをシェーダーに渡す

### デバッグ

ログを有効にするには、UsdzSharpie/Logger.csを確認してください。

## ライセンス

このプロジェクトは開発中です。
